<!DOCTYPE html>
<html>
<head>
  <title>Mapa interactivo con guardado</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />
  <style>
    #map {
      height: 80vh;
      width: 100%;
    }
    #formulario {
      margin: 10px;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <div id="formulario">
    <input type="text" id="nombre" placeholder="Nombre del lugar" />
    <button id="guardarBtn" disabled>Guardar ubicación seleccionada</button>
    <p id="mensaje"></p>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map("map").setView([-17.4, -66.15], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "© OpenStreetMap contributors",
      maxZoom: 18,
    }).addTo(map);

    // Cargar puntos existentes
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRk_WtyKcE2kJXGSTFvze50600ZqjjTc3sivH-Le5Hdr_uSILd_p9AB_wyNlAbKGktpd9y-_aEFpvS6/pub?gid=0&single=true&output=csv";

    function parseCSV(str) {
      const lines = str.trim().split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i].trim());
        return obj;
      });
    }

    fetch(csvUrl)
      .then(res => res.text())
      .then(text => {
        const data = parseCSV(tex
